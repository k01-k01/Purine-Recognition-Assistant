# é£Ÿç‰©è¯†åˆ«ä¸å°¿é…¸åˆ†æAPI (FastAPIç‰ˆæœ¬)

åŸºäºYOLO+ResNetèåˆæ¨¡å‹çš„é£Ÿç‰©è¯†åˆ«å’Œå°¿é…¸å«é‡åˆ†ææœåŠ¡ï¼Œä½¿ç”¨FastAPIæ„å»ºã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- ğŸ½ï¸ **é£Ÿç‰©è¯†åˆ«**: ä½¿ç”¨YOLOæ£€æµ‹å™¨å®šä½é£Ÿç‰©åŒºåŸŸï¼ŒResNetåˆ†ç±»å™¨ç²¾ç¡®è¯†åˆ«é£Ÿç‰©ç±»å‹
- ğŸ§¬ **å°¿é…¸åˆ†æ**: æä¾›è¯¦ç»†çš„å˜Œå‘¤å«é‡ä¿¡æ¯å’Œé¥®é£Ÿå»ºè®®
- ğŸ“Š **è¥å…»ä¼°ç®—**: è®¡ç®—é£Ÿç‰©çš„è¥å…»æˆåˆ†ï¼ˆçƒ­é‡ã€è›‹ç™½è´¨ã€è„‚è‚ªç­‰ï¼‰
- ğŸ¯ **ç—›é£å‹å¥½**: ä¸“é—¨ä¸ºç—›é£æ‚£è€…æä¾›é¥®é£ŸæŒ‡å¯¼
- ğŸš€ **é«˜æ€§èƒ½**: åŸºäºPyTorchå’ŒUltralyticsçš„é«˜æ•ˆæ¨ç†
- ğŸ“± **APIå‹å¥½**: æä¾›RESTful APIæ¥å£ï¼Œæ”¯æŒå¤šç§å®¢æˆ·ç«¯
- ğŸ“š **è‡ªåŠ¨æ–‡æ¡£**: FastAPIè‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼APIæ–‡æ¡£

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯åº”ç”¨    â”‚    â”‚   FastAPIæœåŠ¡   â”‚    â”‚   æ¨¡å‹å±‚        â”‚
â”‚                â”‚    â”‚                â”‚    â”‚                â”‚
â”‚ - Webå‰ç«¯      â”‚â—„â”€â”€â–ºâ”‚ - å›¾ç‰‡ä¸Šä¼       â”‚    â”‚ - YOLOæ£€æµ‹å™¨   â”‚
â”‚ - ç§»åŠ¨åº”ç”¨     â”‚    â”‚ - é£Ÿç‰©è¯†åˆ«      â”‚    â”‚ - ResNetåˆ†ç±»å™¨  â”‚
â”‚ - å°ç¨‹åº       â”‚    â”‚ - å°¿é…¸åˆ†æ      â”‚    â”‚ - é£Ÿç‰©æ•°æ®åº“    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.8+
- è‡³å°‘4GBå†…å­˜
- è‡³å°‘2GBç£ç›˜ç©ºé—´

### 2. ä¸€é”®å®‰è£…

**Linux/Mac:**
```bash
cd project/backend
chmod +x install.sh
./install.sh
```

**Windows:**
```cmd
cd project\backend
install.bat
```

### 3. æ‰‹åŠ¨å®‰è£…

```bash
# å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt

# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p models data logs public
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# æ–¹å¼1: ä½¿ç”¨å¯åŠ¨è„šæœ¬
python start_server.py

# æ–¹å¼2: ç›´æ¥ä½¿ç”¨uvicorn
uvicorn main:app --reload --host 0.0.0.0 --port 3003
```

### 5. è®¿é—®API

- APIæ–‡æ¡£: http://localhost:3003/docs
- å¥åº·æ£€æŸ¥: http://localhost:3003/health
- æœåŠ¡å™¨ä¿¡æ¯: http://localhost:3003/api/info

## ğŸ“¡ APIæ¥å£

### 1. é£Ÿç‰©è¯†åˆ«

**POST** `/api/recognize`

è¯†åˆ«å›¾ç‰‡ä¸­çš„é£Ÿç‰©å¹¶æä¾›å°¿é…¸åˆ†æã€‚

```bash
curl -X POST "http://localhost:3003/api/recognize" \
     -H "Content-Type: application/json" \
     -d '{
       "image": "base64ç¼–ç çš„å›¾ç‰‡æ•°æ®"
     }'
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "success": true,
  "data": {
    "foodName": "apple",
    "purineLevel": "low",
    "purineContent": "5-15mg/100g",
    "suitableForGout": true,
    "advice": "ä½å˜Œå‘¤é£Ÿç‰©ï¼Œç—›é£æ‚£è€…å¯ä»¥æ”¾å¿ƒé£Ÿç”¨",
    "nutritionEstimate": {
      "calories": "52kcal/100g",
      "protein": "0.3g/100g",
      "fat": "0.2g/100g",
      "carbohydrates": "14g/100g",
      "fiber": "2.4g/100g"
    },
    "confidence": 0.95
  }
}
```

### 2. å›¾ç‰‡ä¸Šä¼ 

**POST** `/api/upload`

ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶å¹¶è½¬æ¢ä¸ºbase64æ ¼å¼ã€‚

```bash
curl -X POST "http://localhost:3003/api/upload" \
     -F "file=@food_image.jpg"
```

### 3. è·å–é£Ÿç‰©æ•°æ®åº“

**GET** `/api/foods`

è·å–æ‰€æœ‰é£Ÿç‰©çš„å˜Œå‘¤å«é‡ä¿¡æ¯ã€‚

```bash
curl "http://localhost:3003/api/foods"
```

### 4. è·å–ç‰¹å®šé£Ÿç‰©ä¿¡æ¯

**GET** `/api/foods/{food_name}`

è·å–ç‰¹å®šé£Ÿç‰©çš„è¯¦ç»†ä¿¡æ¯ã€‚

```bash
curl "http://localhost:3003/api/foods/apple"
```

## ğŸ¤– æ¨¡å‹è¯´æ˜

### YOLOæ£€æµ‹å™¨

- **æ¨¡å‹**: YOLOv8n (é¢„è®­ç»ƒ)
- **åŠŸèƒ½**: æ£€æµ‹å›¾ç‰‡ä¸­çš„é£Ÿç‰©åŒºåŸŸ
- **è¾“å…¥**: åŸå§‹å›¾ç‰‡
- **è¾“å‡º**: è¾¹ç•Œæ¡†åæ ‡å’Œç½®ä¿¡åº¦
- **æ”¯æŒç±»åˆ«**: 80ä¸ªCOCOç±»åˆ«ä¸­çš„é£Ÿç‰©ç›¸å…³ç±»åˆ«

### ResNetåˆ†ç±»å™¨

- **æ¨¡å‹**: ResNet-50 (é¢„è®­ç»ƒ)
- **åŠŸèƒ½**: ç²¾ç¡®è¯†åˆ«é£Ÿç‰©ç±»å‹
- **è¾“å…¥**: 224x224å›¾ç‰‡
- **è¾“å‡º**: 1000ä¸ªImageNetç±»åˆ«ä¸­çš„é£Ÿç‰©åˆ†ç±»ç»“æœ

### æ”¯æŒçš„é£Ÿç‰©ç±»å‹

- **æ°´æœ**: è‹¹æœã€é¦™è•‰ã€æ©™å­ç­‰
- **è”¬èœ**: èƒ¡èåœã€è¥¿å…°èŠ±ã€è èœç­‰
- **ä¸»é£Ÿ**: æŠ«è¨ã€æ±‰å ¡ã€ä¸‰æ˜æ²»ç­‰
- **ç”œç‚¹**: è›‹ç³•ã€ç”œç”œåœˆç­‰
- **å…¶ä»–**: çƒ­ç‹—ç­‰

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

```bash
# æœåŠ¡å™¨é…ç½®
PORT=3003                    # æœåŠ¡ç«¯å£
HOST=0.0.0.0                # æœåŠ¡åœ°å€

# æ¨¡å‹é…ç½®
PYTHON_PATH=python          # Pythonè§£é‡Šå™¨è·¯å¾„
MODEL_CONFIDENCE=0.5        # æ£€æµ‹ç½®ä¿¡åº¦é˜ˆå€¼
```

### é£Ÿç‰©æ•°æ®åº“

é£Ÿç‰©æ•°æ®åº“åŒ…å«åœ¨ `utils/food_database.py` ä¸­ï¼Œå¯ä»¥æ·»åŠ æ›´å¤šé£Ÿç‰©ï¼š

```python
def _get_default_foods(self) -> Dict[str, Dict]:
    return {
        'food_name': {
            'purineLevel': 'low|medium|high',
            'purineContent': 'å˜Œå‘¤å«é‡',
            'suitableForGout': True,
            'advice': 'é¥®é£Ÿå»ºè®®',
            'nutrition': { /* è¥å…»æˆåˆ† */ },
            'category': 'é£Ÿç‰©ç±»åˆ«'
        }
    }
```

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ main.py                      # FastAPIä¸»åº”ç”¨
â”œâ”€â”€ requirements.txt             # Pythonä¾èµ–
â”œâ”€â”€ start_server.py             # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ test_api.py                 # APIæµ‹è¯•è„šæœ¬
â”œâ”€â”€ install.sh                  # Linux/Macå®‰è£…è„šæœ¬
â”œâ”€â”€ install.bat                 # Windowså®‰è£…è„šæœ¬
â”œâ”€â”€ models/                     # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ schemas.py             # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ yolo_detector.py       # YOLOæ£€æµ‹å™¨
â”‚   â””â”€â”€ resnet_classifier.py   # ResNetåˆ†ç±»å™¨
â”œâ”€â”€ services/                   # ä¸šåŠ¡æœåŠ¡
â”‚   â””â”€â”€ food_recognition_service.py
â”œâ”€â”€ utils/                      # å·¥å…·ç±»
â”‚   â””â”€â”€ food_database.py       # é£Ÿç‰©æ•°æ®åº“
â””â”€â”€ README.md                   # æ–‡æ¡£
```

### æ·»åŠ æ–°çš„é£Ÿç‰©ç±»åˆ«

1. åœ¨ `utils/food_database.py` ä¸­æ·»åŠ é£Ÿç‰©ä¿¡æ¯
2. åœ¨ `models/resnet_classifier.py` ä¸­æ›´æ–°ç±»åˆ«åˆ—è¡¨
3. é‡å¯æœåŠ¡

### è‡ªå®šä¹‰æ¨¡å‹

1. ä¿®æ”¹ `models/yolo_detector.py` æˆ– `models/resnet_classifier.py`
2. æ›´æ–°æ¨¡å‹åŠ è½½é€»è¾‘
3. é‡å¯æœåŠ¡

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### GPUåŠ é€Ÿ

```bash
# æ£€æŸ¥CUDAå¯ç”¨æ€§
python -c "import torch; print(torch.cuda.is_available())"

# è®¾ç½®ç¯å¢ƒå˜é‡
export CUDA_VISIBLE_DEVICES=0
```

### æ¨¡å‹ä¼˜åŒ–

- ä½¿ç”¨æ¨¡å‹é‡åŒ–å‡å°‘å†…å­˜å ç”¨
- ä½¿ç”¨TensorRTåŠ é€Ÿæ¨ç†
- ä½¿ç”¨æ¨¡å‹å‰ªæå‡å°‘è®¡ç®—é‡

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Pythonç¯å¢ƒé—®é¢˜**
   ```bash
   # æ£€æŸ¥Pythonç‰ˆæœ¬
   python --version
   
   # é‡æ–°å®‰è£…ä¾èµ–
   pip install -r requirements.txt
   ```

2. **æ¨¡å‹ä¸‹è½½å¤±è´¥**
   ```bash
   # æ‰‹åŠ¨ä¸‹è½½YOLOæ¨¡å‹
   python -c "from ultralytics import YOLO; YOLO('yolov8n.pt')"
   ```

3. **å†…å­˜ä¸è¶³**
   - å‡å°‘æ‰¹å¤„ç†å¤§å°
   - ä½¿ç”¨CPUæ¨¡å¼
   - å¢åŠ ç³»ç»Ÿå†…å­˜

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
tail -f logs/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep ERROR logs/app.log
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **è¯†åˆ«å‡†ç¡®ç‡**: 80-90% (å¸¸è§é£Ÿç‰©)
- **å“åº”æ—¶é—´**: 1-3ç§’ (é¦–æ¬¡åŠ è½½æ¨¡å‹)
- **å†…å­˜å ç”¨**: 2-4GB (åŒ…å«æ¨¡å‹)
- **æ”¯æŒå¹¶å‘**: 10-50è¯·æ±‚/ç§’

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python test_api.py

# åˆ›å»ºç¤ºä¾‹å›¾ç‰‡å¹¶æµ‹è¯•
python test_api.py --create-sample

# ä½¿ç”¨è‡ªå®šä¹‰å›¾ç‰‡æµ‹è¯•
python test_api.py --image path/to/image.jpg
```

### æµ‹è¯•è¦†ç›–

- âœ… å¥åº·æ£€æŸ¥
- âœ… APIä¿¡æ¯
- âœ… æ¨¡å‹çŠ¶æ€
- âœ… é£Ÿç‰©æ•°æ®åº“
- âœ… å›¾ç‰‡ä¸Šä¼ 
- âœ… é£Ÿç‰©è¯†åˆ«

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ“ è”ç³»æ–¹å¼

- é¡¹ç›®åœ°å€: [GitHub Repository]
- é—®é¢˜åé¦ˆ: [Issues]
- é‚®ç®±: [your-email@example.com]

---

**æ³¨æ„**: é¦–æ¬¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½YOLOå’ŒResNeté¢„è®­ç»ƒæ¨¡å‹ï¼Œè¯·ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ã€‚ 